<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" href="webApp.css">     
  <link rel="icon" type="image/x-icon" href="../renderer/assets/images/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="../renderer/assets/images/favicon.png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">  
  <title>Current Playlist</title>     
</head>
  
<body onload='initialize()'>
  <header>
    <h3>Current Playlist</h3>
  </header>
    
  <section class="scrollable-folder-table large">
    <table class ="folder-table " id="playlists" >    
      <colgroup>
        <col class="folder-name">
        <col class="folder-icon">
      </colgroup>              
    </table>  
  </section>
      
  <section class="bottom-buttons">    
    <button id="accept" name="accept"  onclick="SaveChanges()">Save</button>
    <button id="home" name="home"  onclick="location.href='/';">Cancel</button>
  </section>      

<script type='text/javascript' src='appServer.js'></script>
<script src="../../common/customAlert.js"></script>
<script>

  let playlistNames = []; //all loaded playlists
  let selectedPlaylist = ""; // user selected playlist from click
  let currentPlaylist = ""; //currently loaded playlist


  async function SaveChanges(){    
    if (selectedPlaylist !== currentPlaylist) {
      let savedata = {
        selPLAYLIST: 'playlist_'+ selectedPlaylist
      };      
      let result = await PrepMessage("app_writeDB", savedata);
    }    
    location.href = '/'; 
  }

  async function initialize(){
    data = await PrepMessage('app_readDB');
    WriteUI(data);            
  }
  
  function WriteUI(data) {
    const playlistTable = document.getElementById("playlists");
    playlistNames = data.playlists; // does not include playlist_   but includes exclude/include statements
    currentPlaylist = data.selPLAYLIST;  // excludes playlist_    
    currentPlaylist = currentPlaylist.substring("playlist_".length);

    playlistNames = playlistNames.sort();    

    playlistNames.forEach((playlistName, index) => {
            
      let newRow = playlistTable.insertRow();

      // Highlight if this is the selected playlist
      if (playlistName === currentPlaylist) {
        // remove everything after the _
        newRow.innerHTML = `<td>${playlistName.split("_")[0]}</td> <td><img src="../renderer/assets/images/app star.png"></td>`;        
      }else{
        newRow.innerHTML = `<td>${playlistName.split("_")[0]}</td> <td></td>`;         
      }       
    });
  }

  
  document.getElementById("playlists").addEventListener("click", function(event) {
    // Find the nearest parent <tr> of the clicked element
    const row = event.target.closest("tr"); // Get the clicked row    
    selectedPlaylist = playlistNames[row.rowIndex];   
    if (!row) return;
    // Remove 'selected-row' class from all rows
    const rows = document.querySelectorAll("#playlists tr");
    rows.forEach(r => r.classList.remove("selected-row"));
    // Add 'selected-row' class to the clicked row
    row.classList.add("selected-row");
  });




  </script>
</body> 
</html>
