
<!DOCTYPE html>
<html lang="en">
<head>  
  <link rel="stylesheet" href="webApp.css">     
  <link rel="icon" type="image/x-icon" href="../renderer/assets/images/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="../renderer/assets/images/favicon.png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">  
  <title>Playlists</title> 
</head>
  

<body onload='initialize()'>
  <header>
    <h3>Manage Playlists</h3>
  </header>
    
  <section class="scrollable-folder-table large">    
    <table class="folder-table" id="playlists">          
      <colgroup>
        <col class="folder-name">
        <col class="folder-icon">
      </colgroup>              
    </table>    
  </section>
      
  <div class="bottom-buttons-images">
    <input type="image" id="home" name="home" src="../renderer/assets/images/home.png"  onclick="location.href='/appOptions';">
    <input type="image" id="newPlaylist" name="newPlaylist" src="../renderer/assets/images/plusicon.png" onclick="NewPlaylist()">
  </div>
   

<script type='text/javascript' src='appServer.js'></script>
<script src="../../common/customAlert.js"></script> 
<script>

  let playlistNames = null;

  async function initialize(){
    returnData = await PrepMessage('app_readDB');
    WriteUI(returnData);        
  }

  function WriteUI(data) {
    const playlistTable = document.getElementById("playlists");
    playlistNames = data.playlists; // does not include playlist_   but includes exclude/include statements
    currentPlaylist = data.selPLAYLIST.replace(/^playlist_/, "");  // exclude playlist_    
        
    playlistNames = playlistNames.sort();    

    playlistNames.forEach((playlistName, index) => {
            
      let newRow = playlistTable.insertRow();

      // Highlight if this is the selected playlist
      if (playlistName === currentPlaylist) {
        // remove everything after the _
        newRow.innerHTML = `<td>${playlistName.split("_")[0]}</td> <td><img src="../renderer/assets/images/app star.png"></td>`;        
      }else{
        newRow.innerHTML = `<td>${playlistName.split("_")[0]}</td> <td></td>`;         
      }       
    });
  }

  document.getElementById("playlists").addEventListener("click", function(event) {
    // Find the nearest parent <tr> of the clicked element
    const row = event.target.closest("tr");

    // Make sure the click was on a row inside the table body
    if (row && document.getElementById("playlists").contains(row)) {
      // Do something with the row            
      selectedPlaylist = playlistNames[row.rowIndex];
      location.href = `/appEditPlaylist?value=${encodeURIComponent("playlist_"+selectedPlaylist)}`;
    }
  });

  function NewPlaylist(){
    location.href = `/appEditPlaylist?value=${encodeURIComponent('')}`;
  }

</script>
</body> 
</html>
