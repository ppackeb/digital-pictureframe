
<!DOCTYPE html>
<html>

<head>
  <style>


html, body {
  height: 100%;
  margin: 5px;
  padding: 5px;
}

body {
  font-family: Arial, sans-serif;
  font-size: 20px;
  line-height: 1.2;
}
  
input, button, select, textarea {
    font-family: inherit;
    font-size: inherit;
    line-height: inherit;
}

  th, td {      
    font-family: Arial, sans-serif;
    text-align: left;
    padding: 8px;
    font-size:20px;
    overflow: hidden;
    text-overflow: ellipsis;
  }   

.table-wrapper {
  overflow-y: auto;
  padding-bottom: 10px; /* Optional: small bottom space */
  height: calc(100vh - 120px); /* Adjust 120px based on button size + spacing */
}

  .bottom-buttons {
    position: fixed;
    bottom: 0;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 80px;
    padding: 10px 0;
    background-color: white; /* optional: ensure text behind it doesn't bleed through */
  }



</style>

  <link rel="icon" type="image/x-icon" href="../renderer/assets/images/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">  
</head>
  

<body onload='initialize()'>
  <b><center>Manage Playlists</center></b>
  <br>
  <div class="table-wrapper">
    <table id="playlists" style="width:100%; border-collapse: collapse;">    
      <tbody>
        <!-- Rows will be inserted here -->
      </tbody>
    </table>
  </div>
      
  <div class="bottom-buttons">
    <input type="image" id="home" name="home" src="../renderer/assets/images/home.png"  style="height:80px" onclick="location.href='/appOptions';">
    <input type="image" id="newPlaylist" name="newPlaylist" style="height:70px" src="../renderer/assets/images/plusicon.png" onclick="NewPlaylist()">
  </div>
   
</body> 
<script type='text/javascript' src='appServer.js'></script>
<script src="../../common/customAlert.js"></script> 
<script>

  let playlistNames = null;

  async function PrepMessage(payload){  
    messagePayload = null;
    switch (payload){
      case 'app_readDB':
        messagePayload = {command:"app_readDB", data: null};
      break;              
    }  
    try {
      // Await the response from the new, async makeRequest function.
      returnData = await makeRequest('/app_sendrequest', messagePayload);
      command = returnData.command;
      data = returnData.data;
      // Handle the response based on the command.
      switch(messagePayload.command){
        case 'app_readDB':
          return data;
        break;
        default:          
        break;
      }      
    } catch (error) {        
      //ShowAlert('Error in html POST. '+ error, false).then((result) => { })  
    } 
  }
  

  async function initialize(){
    returnData = await PrepMessage('app_readDB')
    WriteUI(returnData);        
  }

function WriteUI(data) {
  playlists = data.playlists;
  SelectedPlaylist = data.selplaylist;  
  const tableBody = document.getElementById('playlists').getElementsByTagName('tbody')[0];
  tableBody.innerHTML = '';

  playlistNames = Object.keys(playlists);

  // Sort by the second part (displayName) in a case-insensitive manner
  playlistNames.sort((a, b) => {
    const nameA = a.split('_')[1]?.toLowerCase() || '';
    const nameB = b.split('_')[1]?.toLowerCase() || '';
    return nameA.localeCompare(nameB);
  });

  playlistNames.forEach((name, index) => {
    parts = name.split('_');
    displayName = parts[1];
    PlaylistFullName = name.replace(/^playlist_/, '');

    const row = document.createElement('tr');
    if (index % 2 === 0) {
      row.style.backgroundColor = '#f0f0f0';
    }

    
      // Highlight if this is the selected playlist
    if (PlaylistFullName === SelectedPlaylist) {
      row.innerHTML = `<td>${displayName}<img src="app star.png" alt="comment" style="height:8px; width:auto"></td>`;
      row.classList.add('selected-row'); // Add a CSS class
      row.setAttribute('data-selected', 'true'); // Add a data attribute for programmatic access
    }else{
      row.innerHTML = `<td>${displayName}</td>`;  
    } 
    tableBody.appendChild(row);

    // const cell = document.createElement('td');
    //cell.textContent = displayName;
    //row.appendChild(cell);
    //tableBody.appendChild(row);
  });
}

  document.getElementById("playlists").addEventListener("click", function(event) {
    // Find the nearest parent <tr> of the clicked element
    const row = event.target.closest("tr");

    // Make sure the click was on a row inside the table body
    if (row && document.getElementById("playlists").contains(row)) {
      // Do something with the row            
      selectedPlaylist = playlistNames[row.rowIndex];
      location.href = `/appEditPlaylist?value=${encodeURIComponent(selectedPlaylist)}`;
    }
  });

  function NewPlaylist(){
    location.href = `/appEditPlaylist?value=${encodeURIComponent('')}`;
  }

</script>

</html>
